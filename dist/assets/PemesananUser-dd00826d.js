import{a as p}from"./axios-8e4517c3.js";import{S as m}from"./sweetalert2-50e64164.js";import{_ as S,h as b,o as l,c as d,l as P,a,g,m as C,n as M,k,F as y,i as _,t as i,b as f,v as w,j as T}from"./index-7bde77bb.js";import{N as B,F as E}from"./Footer-4274acd5.js";const I={},U={class:"nav-item"};function N(n,e){const r=b("router-link");return l(),d("ul",{class:M(["navbar-nav bg-light sidebar sidebar-dark accordion",{toggled:n.sidebarToggled}]),id:"accordionSidebar"},[e[1]||(e[1]=P('<a class="sidebar-brand d-flex align-items-center justify-content-center" href="#"><div class="sidebar-brand-icon mt-2"></div><div class="sidebar-brand-text ms-3"><span class="text-primary">Rental PS</span></div></a><div class="sidebar-heading mt-5 text-primary">Menu</div>',2)),a("li",U,[g(r,{class:"nav-link text-primary",to:"/pemesanan-ps","active-class":"font-weight-bold text-primary active-link"},{default:C(()=>e[0]||(e[0]=[a("i",{class:"bi bi-journal-text text-primary fw-bold"},null,-1),a("span",null,"Pemesanan",-1)])),_:1})]),e[2]||(e[2]=a("hr",{class:"sidebar-divider d-none d-md-block"},null,-1))],2)}const A=S(I,[["render",N]]);const D={name:"PemesananManagement",components:{Sidebar:A,Navbar:B,Footer:E},data(){return{pemesananList:[],availableMenu:[],form:{id:"",tanggal_sewa:"",durasi:1,menu_id:""},isEdit:!1,modalInstance:null}},methods:{async fetchPemesanan(){try{const n=await p.get("https://apirental.keuanganfpti.com/api/pemesanan/list",{headers:{Authorization:`Bearer ${sessionStorage.getItem("token")}`}});this.pemesananList=n.data.data}catch(n){console.error("Error fetching pemesanan:",n)}},async fetchAvailableMenu(){if(this.form.tanggal_sewa)try{const n=await p.post("https://apirental.keuanganfpti.com/api/menu/available",{tanggal:this.form.tanggal_sewa},{headers:{Authorization:`Bearer ${sessionStorage.getItem("token")}`}});this.availableMenu=n.data}catch(n){console.error("Error fetching available menu:",n)}},async submitForm(){const n=this.isEdit?"/pemesanan/update":"/pemesanan/create";try{const e=await p.post(`https://apirental.keuanganfpti.com/api${n}`,this.form,{headers:{Authorization:`Bearer ${sessionStorage.getItem("token")}`}});e.data&&e.data.data&&e.data.data.redirect_url?window.location.href=e.data.data.redirect_url:(m.fire("Success!",this.isEdit?"Pemesanan diperbarui!":"Pemesanan ditambahkan!","success"),this.hideModal(),this.fetchPemesanan())}catch{m.fire("Error!","Terjadi kesalahan dalam proses.","error")}},async deletePemesanan(n){if((await m.fire({title:"Yakin ingin menghapus?",icon:"warning",showCancelButton:!0,confirmButtonText:"Hapus",cancelButtonText:"Batal"})).isConfirmed)try{await p.delete(`https://apirental.keuanganfpti.com/api/pemesanan/delete/${n}`,{headers:{Authorization:`Bearer ${sessionStorage.getItem("token")}`}}),m.fire("Berhasil!","Pemesanan berhasil dihapus.","success"),this.fetchPemesanan()}catch{m.fire("Error!","Gagal menghapus pemesanan.","error")}},openModal(n,e=null){this.isEdit=n==="update",this.form=e?{...e}:{id:"",tanggal_sewa:"",durasi:1,menu_id:"",user_id:""},this.modalInstance=new bootstrap.Modal(this.$refs.pemesananModalRef),this.modalInstance.show()},hideModal(){this.modalInstance&&this.modalInstance.hide()}},created(){const n=new Date().toUTCString();console.log("Waktu Sekarang (UTC):",n);const e=sessionStorage.getItem("token");if(e)try{const[r,v]=e.split("."),s=JSON.parse(atob(r)),o=atob(v),u=JSON.parse(atob(e.split(".")[1])),h=u.exp,c=new Date(h*1e3);console.log("Waktu Kedaluwarsa (UTC):",c.toUTCString()),new Date>c?(console.log("Keluar"),sessionStorage.removeItem("token"),this.$router.push("/")):console.log("Aman");const t=u.level;this.user_id=u.id,t!=="1"?this.$router.push("/unauthorized"):(!s||!o)&&(this.$router.push("/"),sessionStorage.removeItem("token")),this.fetchPemesanan()}catch(r){console.error("Error decoding token:",r),this.$router.push("/")}else this.$router.push("/")}},F={id:"wrapper"},j={id:"content-wrapper",class:"d-flex flex-column"},z={id:"content"},V={class:"container-fluid mt-4"},R={class:"table"},L=["onClick"],$={class:"modal fade",id:"pemesananModal",tabindex:"-1","aria-labelledby":"pemesananModalLabel","aria-hidden":"true",ref:"pemesananModalRef"},J={class:"modal-dialog modal-lg modal-dialog-centered"},K={class:"modal-content"},O={class:"modal-header"},W={class:"modal-title"},q={class:"modal-body"},G=["value"],H={class:"modal-footer"};function Y(n,e,r,v,s,o){const u=b("Sidebar"),h=b("Navbar"),c=b("Footer");return l(),d("div",F,[g(u,{class:M(n.sidebarClass)},null,8,["class"]),a("div",j,[a("div",z,[g(h,{onToggleSidebar:n.toggleSidebar},null,8,["onToggleSidebar"]),a("div",V,[e[11]||(e[11]=a("h1",{class:"h3 mb-0 text-gray-800 text-center"},"Manajemen Pemesanan",-1)),a("button",{class:"btn btn-primary mb-3",onClick:e[0]||(e[0]=t=>o.openModal("create"))},e[8]||(e[8]=[a("i",{class:"bi bi-plus-lg"},null,-1),k(" Pemesanan ")])),a("table",R,[e[10]||(e[10]=a("thead",null,[a("tr",null,[a("th",null,"No"),a("th",null,"Tanggal Sewa"),a("th",null,"Durasi"),a("th",null,"Menu"),a("th",null,"Status"),a("th",null,"Actions")])],-1)),a("tbody",null,[(l(!0),d(y,null,_(s.pemesananList,(t,x)=>(l(),d("tr",{key:t.id},[a("td",null,i(x+1),1),a("td",null,i(t.tanggal_sewa),1),a("td",null,i(t.durasi),1),a("td",null,i(t.menu.name),1),a("td",null,i(t.payment.status),1),a("td",null,[a("button",{class:"btn btn-warning btn-sm me-2",onClick:Q=>o.openModal("update",t)},e[9]||(e[9]=[a("i",{class:"bi bi-pencil-square"},null,-1),k(" Edit ")]),8,L)])]))),128))])])]),g(c)])]),a("div",$,[a("div",J,[a("div",K,[a("div",O,[a("h5",W,i(s.isEdit?"Update Pemesanan":"Tambah Pemesanan"),1),a("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close",onClick:e[1]||(e[1]=(...t)=>o.hideModal&&o.hideModal(...t))},e[12]||(e[12]=[a("span",{"aria-hidden":"true"},"Ã—",-1)]))]),a("div",q,[e[14]||(e[14]=a("label",{for:"tanggal_sewa"},"Tanggal Sewa",-1)),f(a("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>s.form.tanggal_sewa=t),type:"date",class:"form-control mb-3",onChange:e[3]||(e[3]=(...t)=>o.fetchAvailableMenu&&o.fetchAvailableMenu(...t))},null,544),[[w,s.form.tanggal_sewa]]),e[15]||(e[15]=a("i",{style:{color:"red","font-size":"10px"}},"* khusus weekend akan dikenakan biaya tambahan Rp. 50.000",-1)),e[16]||(e[16]=a("br",null,null,-1)),e[17]||(e[17]=a("label",{for:"durasi"},"Durasi (hari)",-1)),f(a("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>s.form.durasi=t),type:"number",class:"form-control mb-3",placeholder:"Durasi"},null,512),[[w,s.form.durasi,void 0,{number:!0}]]),e[18]||(e[18]=a("label",{for:"menu_id"},"Menu Sewa",-1)),f(a("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>s.form.menu_id=t),class:"form-control mb-3"},[e[13]||(e[13]=a("option",{value:""},"Pilih Menu",-1)),(l(!0),d(y,null,_(s.availableMenu,t=>(l(),d("option",{key:t.id,value:t.id},i(t.name)+" - "+i(t.jenis)+" - "+i(t.jenis==="PS 4"?"Rp. 30.000 / sesi":"Rp. 40.000 / sesi"),9,G))),128))],512),[[T,s.form.menu_id]])]),a("div",H,[a("button",{type:"button",class:"btn btn-secondary",onClick:e[6]||(e[6]=(...t)=>o.hideModal&&o.hideModal(...t))}," Batal "),a("button",{type:"button",class:"btn btn-primary",onClick:e[7]||(e[7]=(...t)=>o.submitForm&&o.submitForm(...t))},i(s.isEdit?"Update":"Tambah"),1)])])])],512)])}const te=S(D,[["render",Y],["__scopeId","data-v-ecc9bd77"]]);export{te as default};
