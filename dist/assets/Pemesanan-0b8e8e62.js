import{a as p}from"./axios-8e4517c3.js";import{S as d}from"./sweetalert2-50e64164.js";import{S as C}from"./Sidebar-155f80f3.js";import{N as T,F as P}from"./Footer-4274acd5.js";import{_ as x,h as b,o as u,c as m,g,n as B,a,F as _,i as k,t as r,b as f,v as w,j as E,k as S}from"./index-7bde77bb.js";const I={name:"PemesananManagement",components:{Sidebar:C,Navbar:T,Footer:P},data(){return{pemesananList:[],availableMenu:[],form:{id:"",tanggal_sewa:"",durasi:1,menu_id:""},isEdit:!1,modalInstance:null}},methods:{async fetchPemesanan(){try{const n=await p.get("https://apirental.keuanganfpti.com/api/pemesanan/list",{headers:{Authorization:`Bearer ${sessionStorage.getItem("token")}`}});this.pemesananList=n.data.data}catch(n){console.error("Error fetching pemesanan:",n)}},async fetchAvailableMenu(){if(this.form.tanggal_sewa)try{const n=await p.post("https://apirental.keuanganfpti.com/api/menu/available",{tanggal:this.form.tanggal_sewa},{headers:{Authorization:`Bearer ${sessionStorage.getItem("token")}`}});this.availableMenu=n.data}catch(n){console.error("Error fetching available menu:",n)}},async submitForm(){const n=this.isEdit?"/pemesanan/update":"/pemesanan/create";try{const e=await p.post(`https://apirental.keuanganfpti.com/api${n}`,this.form,{headers:{Authorization:`Bearer ${sessionStorage.getItem("token")}`}});e.data&&e.data.data&&e.data.data.redirect_url?window.location.href=e.data.data.redirect_url:(d.fire("Success!",this.isEdit?"Pemesanan diperbarui!":"Pemesanan ditambahkan!","success"),this.hideModal(),this.fetchPemesanan())}catch{d.fire("Error!","Terjadi kesalahan dalam proses.","error")}},async deletePemesanan(n){if((await d.fire({title:"Yakin ingin menghapus?",icon:"warning",showCancelButton:!0,confirmButtonText:"Hapus",cancelButtonText:"Batal"})).isConfirmed)try{await p.delete(`https://apirental.keuanganfpti.com/api/pemesanan/delete/${n}`,{headers:{Authorization:`Bearer ${sessionStorage.getItem("token")}`}}),d.fire("Berhasil!","Pemesanan berhasil dihapus.","success"),this.fetchPemesanan()}catch{d.fire("Error!","Gagal menghapus pemesanan.","error")}},openModal(n,e=null){this.isEdit=n==="update",this.form=e?{...e}:{id:"",tanggal_sewa:"",durasi:1,menu_id:"",user_id:""},this.modalInstance=new bootstrap.Modal(this.$refs.pemesananModalRef),this.modalInstance.show()},hideModal(){this.modalInstance&&this.modalInstance.hide()}},created(){const n=new Date().toUTCString();console.log("Waktu Sekarang (UTC):",n);const e=sessionStorage.getItem("token");if(e)try{const[i,v]=e.split("."),s=JSON.parse(atob(i)),o=atob(v),l=JSON.parse(atob(e.split(".")[1])),h=l.exp,c=new Date(h*1e3);console.log("Waktu Kedaluwarsa (UTC):",c.toUTCString()),new Date>c?(console.log("Keluar"),sessionStorage.removeItem("token"),this.$router.push("/")):console.log("Aman");const t=l.level;this.user_id=l.id,t!=="0"?this.$router.push("/unauthorized"):(!s||!o)&&(this.$router.push("/"),sessionStorage.removeItem("token")),this.fetchPemesanan()}catch(i){console.error("Error decoding token:",i),this.$router.push("/")}else this.$router.push("/")}},N={id:"wrapper"},U={id:"content-wrapper",class:"d-flex flex-column"},A={id:"content"},D={class:"container-fluid mt-4"},F={class:"table"},z=["onClick"],V=["onClick"],L={class:"modal fade",id:"pemesananModal",tabindex:"-1","aria-labelledby":"pemesananModalLabel","aria-hidden":"true",ref:"pemesananModalRef"},j={class:"modal-dialog modal-lg modal-dialog-centered"},H={class:"modal-content"},J={class:"modal-header"},K={class:"modal-title"},O={class:"modal-body"},R=["value"],W={class:"modal-footer"};function $(n,e,i,v,s,o){const l=b("Sidebar"),h=b("Navbar"),c=b("Footer");return u(),m("div",N,[g(l,{class:B(n.sidebarClass)},null,8,["class"]),a("div",U,[a("div",A,[g(h,{onToggleSidebar:n.toggleSidebar},null,8,["onToggleSidebar"]),a("div",D,[e[10]||(e[10]=a("h1",{class:"h3 mb-0 text-gray-800 text-center mb-3"}," Manajemen Pemesanan ",-1)),a("table",F,[e[9]||(e[9]=a("thead",null,[a("tr",null,[a("th",null,"No"),a("th",null,"Tanggal Sewa"),a("th",null,"Durasi"),a("th",null,"Menu"),a("th",null,"Status"),a("th",null,"Actions")])],-1)),a("tbody",null,[(u(!0),m(_,null,k(s.pemesananList,(t,y)=>(u(),m("tr",{key:t.id},[a("td",null,r(y+1),1),a("td",null,r(t.tanggal_sewa),1),a("td",null,r(t.durasi),1),a("td",null,r(t.menu.name),1),a("td",null,r(t.payment.status),1),a("td",null,[a("button",{class:"btn btn-warning btn-sm me-2",onClick:M=>o.openModal("update",t)},e[7]||(e[7]=[a("i",{class:"bi bi-pencil-square"},null,-1),S(" Edit ")]),8,z),a("button",{class:"btn btn-danger btn-sm",onClick:M=>o.deletePemesanan(t.id)},e[8]||(e[8]=[a("i",{class:"bi bi-trash3-fill"},null,-1),S(" Hapus ")]),8,V)])]))),128))])])]),g(c)])]),a("div",L,[a("div",j,[a("div",H,[a("div",J,[a("h5",K,r(s.isEdit?"Update Pemesanan":"Tambah Pemesanan"),1),a("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close",onClick:e[0]||(e[0]=(...t)=>o.hideModal&&o.hideModal(...t))},e[11]||(e[11]=[a("span",{"aria-hidden":"true"},"Ã—",-1)]))]),a("div",O,[e[13]||(e[13]=a("label",{for:"tanggal_sewa"},"Tanggal Sewa",-1)),f(a("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>s.form.tanggal_sewa=t),type:"date",class:"form-control mb-3",onChange:e[2]||(e[2]=(...t)=>o.fetchAvailableMenu&&o.fetchAvailableMenu(...t))},null,544),[[w,s.form.tanggal_sewa]]),e[14]||(e[14]=a("label",{for:"durasi"},"Durasi (hari)",-1)),f(a("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>s.form.durasi=t),type:"number",class:"form-control mb-3",placeholder:"Durasi"},null,512),[[w,s.form.durasi,void 0,{number:!0}]]),e[15]||(e[15]=a("label",{for:"menu_id"},"Menu Sewa",-1)),f(a("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>s.form.menu_id=t),class:"form-control mb-3"},[e[12]||(e[12]=a("option",{value:""},"Pilih Menu",-1)),(u(!0),m(_,null,k(s.availableMenu,t=>(u(),m("option",{key:t.id,value:t.id},r(t.name)+" - "+r(t.jenis),9,R))),128))],512),[[E,s.form.menu_id]])]),a("div",W,[a("button",{type:"button",class:"btn btn-secondary",onClick:e[5]||(e[5]=(...t)=>o.hideModal&&o.hideModal(...t))}," Batal "),a("button",{type:"button",class:"btn btn-primary",onClick:e[6]||(e[6]=(...t)=>o.submitForm&&o.submitForm(...t))},r(s.isEdit?"Update":"Tambah"),1)])])])],512)])}const Z=x(I,[["render",$],["__scopeId","data-v-4713eb9a"]]);export{Z as default};
