import{a as c}from"./axios-8e4517c3.js";import{S as l}from"./sweetalert2-50e64164.js";import{S as v}from"./Sidebar-155f80f3.js";import{N as k,F as y}from"./Footer-4274acd5.js";import{_ as C,h,o as p,c as g,g as f,n as w,a as e,F as x,i as F,t as d,b as _,v as T,j as E}from"./index-7bde77bb.js";const I={name:"MenuManagement",components:{Sidebar:v,Navbar:k,Footer:y},data(){return{sidebarToggled:!1,sidebarClass:"",menus:[],form:{id:"",name:"",jenis:"",image:null},isEdit:!1,modalInstance:null}},methods:{toggleSidebar(){this.sidebarToggled=!this.sidebarToggled,this.sidebarClass=this.sidebarToggled?"toggle-sidebar":""},async fetchMenus(){try{const o=await c.get("https://apirental.keuanganfpti.com/api/menu/list",{headers:{Authorization:`Bearer ${sessionStorage.getItem("token")}`}});this.menus=o.data.data}catch(o){console.error("Error fetching menu:",o)}},handleFileUpload(o){this.form.image=o.target.files[0]},async submitForm(){const o=new FormData;this.isEdit&&o.append("id",this.form.id),o.append("name",this.form.name),o.append("jenis",this.form.jenis),this.form.image&&o.append("image",this.form.image);const t=this.isEdit?"/menu/update":"/menu/create";try{const i=await c.post(`https://apirental.keuanganfpti.com/api${t}`,o,{headers:{Authorization:`Bearer ${sessionStorage.getItem("token")}`}});l.fire("Success!",this.isEdit?"Menu updated successfully":"Menu created successfully","success"),this.hideModal(),this.resetForm(),this.fetchMenus()}catch{l.fire("Error!","An error occurred while processing the request.","error")}},openModal(o,t=null){this.isEdit=o==="update",this.isEdit&&t?this.form={...t,image:null}:this.resetForm(),this.modalInstance=new bootstrap.Modal(this.$refs.menuModalRef),this.modalInstance.show()},hideModal(){this.modalInstance&&this.modalInstance.hide()},resetForm(){this.form={id:"",name:"",jenis:"",image:null},this.isEdit=!1},async deleteMenu(o){try{(await l.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel"})).isConfirmed&&(await c.delete(`https://apirental.keuanganfpti.com/api/menu/delete/${o}`,{headers:{Authorization:`Bearer ${sessionStorage.getItem("token")}`}}),l.fire("Deleted!","Menu has been deleted.","success"),this.fetchMenus())}catch{l.fire("Error!","An error occurred while deleting the menu.","error")}}},created(){const o=new Date().toUTCString();console.log("Waktu Sekarang (UTC):",o);const t=sessionStorage.getItem("token");if(t)try{const[i,b]=t.split("."),a=JSON.parse(atob(i)),n=atob(b),r=JSON.parse(atob(t.split(".")[1])),u=r.exp,m=new Date(u*1e3);console.log("Waktu Kedaluwarsa (UTC):",m.toUTCString()),new Date>m?(console.log("Keluar"),sessionStorage.removeItem("token"),this.$router.push("/")):console.log("Aman");const s=r.level;this.user_id=r.id,s!=="0"?this.$router.push("/unauthorized"):(!a||!n)&&(this.$router.push("/"),sessionStorage.removeItem("token")),this.fetchMenus()}catch(i){console.error("Error decoding token:",i),this.$router.push("/")}else this.$router.push("/")}},B={id:"wrapper"},U={id:"content-wrapper",class:"d-flex flex-column"},N={id:"content"},D={class:"container-fluid mt-4"},A={class:"table"},j=["src"],P=["onClick"],z=["onClick"],J={class:"modal fade",id:"menuModal",tabindex:"-1","aria-labelledby":"menuModalLabel","aria-hidden":"true",ref:"menuModalRef"},V={class:"modal-dialog modal-lg modal-dialog-centered"},L={class:"modal-content"},K={class:"modal-header"},O={class:"modal-title",id:"menuModalLabel"},R={class:"modal-body"},W={class:"modal-footer"};function Y(o,t,i,b,a,n){const r=h("Sidebar"),u=h("Navbar"),m=h("Footer");return p(),g("div",B,[f(r,{class:w(a.sidebarClass)},null,8,["class"]),e("div",U,[e("div",N,[f(u,{onToggleSidebar:n.toggleSidebar},null,8,["onToggleSidebar"]),e("div",D,[t[8]||(t[8]=e("h1",{class:"h3 mb-0 text-gray-800 text-center"},"Stok PS",-1)),e("button",{class:"btn btn-primary mb-3",onClick:t[0]||(t[0]=s=>n.openModal("create"))}," Add Menu "),e("table",A,[t[7]||(t[7]=e("thead",null,[e("tr",null,[e("th",null,"No"),e("th",null,"Image"),e("th",null,"Name"),e("th",null,"Jenis"),e("th",null,"Actions")])],-1)),e("tbody",null,[(p(!0),g(x,null,F(a.menus,(s,M)=>(p(),g("tr",{key:s.id},[e("td",null,d(M+1),1),e("td",null,[e("img",{src:`https://apirental.keuanganfpti.com/storage/${s.image}`,alt:"Menu Image",style:{"max-width":"100px","max-height":"100px"}},null,8,j)]),e("td",null,d(s.name),1),e("td",null,d(s.jenis),1),e("td",null,[e("button",{class:"btn btn-warning btn-sm me-2",onClick:S=>n.openModal("update",s)}," Edit ",8,P),e("button",{class:"btn btn-danger btn-sm",onClick:S=>n.deleteMenu(s.id)}," Delete ",8,z)])]))),128))])])]),f(m)])]),e("div",J,[e("div",V,[e("div",L,[e("div",K,[e("h5",O,d(a.isEdit?"Update Menu":"Create Menu"),1),e("button",{type:"button",class:"close","data-dismiss":"modal","aria-label":"Close",onClick:t[1]||(t[1]=(...s)=>n.hideModal&&n.hideModal(...s))},t[9]||(t[9]=[e("span",{"aria-hidden":"true"},"Ã—",-1)]))]),e("div",R,[_(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>a.form.name=s),class:"form-control mb-3",placeholder:"Menu Name"},null,512),[[T,a.form.name]]),_(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>a.form.jenis=s),class:"form-control mb-3"},t[10]||(t[10]=[e("option",{value:""},"Pilih Jenis PS",-1),e("option",{value:"PS 4"},"PS 4",-1),e("option",{value:"PS 5"},"PS 5",-1)]),512),[[E,a.form.jenis]]),e("input",{type:"file",class:"form-control mb-3",onChange:t[4]||(t[4]=(...s)=>n.handleFileUpload&&n.handleFileUpload(...s))},null,32)]),e("div",W,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[5]||(t[5]=(...s)=>n.hideModal&&n.hideModal(...s))},"Batal"),e("button",{type:"button",class:"btn btn-primary",onClick:t[6]||(t[6]=(...s)=>n.submitForm&&n.submitForm(...s))},d(a.isEdit?"Update":"Create"),1)])])])],512)])}const X=C(I,[["render",Y],["__scopeId","data-v-4641170f"]]);export{X as default};
